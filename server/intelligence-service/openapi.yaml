openapi: 3.1.0
info:
  version: 0.9.0-rc.27
  title: Hephaestus Intelligence Service API
components:
  schemas:
    HealthCheck:
      type: object
      properties:
        status:
          type: string
          enum:
            - OK
          description: Health status
          example: OK
      required:
        - status
    ChatThreadSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - title
    ChatThreadGroup:
      type: object
      properties:
        groupName:
          type: string
        threads:
          type: array
          items:
            $ref: "#/components/schemas/ChatThreadSummary"
      required:
        - groupName
        - threads
    StreamTextStartPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - text-start
        id:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
    StreamTextDeltaPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - text-delta
        id:
          type: string
        delta:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
        - delta
    StreamTextEndPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - text-end
        id:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
    StreamErrorPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - error
        errorText:
          type: string
      required:
        - type
        - errorText
    StreamToolInputStartPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-input-start
        toolCallId:
          type: string
        toolName:
          type: string
        providerExecuted:
          type: boolean
        dynamic:
          type: boolean
      required:
        - type
        - toolCallId
        - toolName
    StreamToolInputDeltaPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-input-delta
        toolCallId:
          type: string
        inputTextDelta:
          type: string
      required:
        - type
        - toolCallId
        - inputTextDelta
    StreamToolInputAvailablePart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-input-available
        toolCallId:
          type: string
        toolName:
          type: string
        input: {}
        providerExecuted:
          type: boolean
        providerMetadata: {}
        dynamic:
          type: boolean
      required:
        - type
        - toolCallId
        - toolName
    StreamToolInputErrorPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-input-error
        toolCallId:
          type: string
        toolName:
          type: string
        input: {}
        errorText:
          type: string
        providerExecuted:
          type: boolean
        providerMetadata: {}
        dynamic:
          type: boolean
      required:
        - type
        - toolCallId
        - toolName
        - errorText
    StreamToolOutputAvailablePart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-output-available
        toolCallId:
          type: string
        output: {}
        providerExecuted:
          type: boolean
        dynamic:
          type: boolean
      required:
        - type
        - toolCallId
    StreamToolOutputErrorPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - tool-output-error
        toolCallId:
          type: string
        errorText:
          type: string
        providerExecuted:
          type: boolean
        dynamic:
          type: boolean
      required:
        - type
        - toolCallId
        - errorText
    StreamReasoningStartPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - reasoning-start
        id:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
    StreamReasoningDeltaPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - reasoning-delta
        id:
          type: string
        delta:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
        - delta
    StreamReasoningEndPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - reasoning-end
        id:
          type: string
        providerMetadata: {}
      required:
        - type
        - id
    StreamSourceUrlPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - source-url
        sourceId:
          type: string
        url:
          type: string
        title:
          type: string
        providerMetadata: {}
      required:
        - type
        - sourceId
        - url
    StreamSourceDocumentPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - source-document
        sourceId:
          type: string
        mediaType:
          type: string
        title:
          type: string
        filename:
          type: string
        providerMetadata: {}
      required:
        - type
        - sourceId
        - mediaType
        - title
    StreamFilePart:
      type: object
      properties:
        type:
          type: string
          enum:
            - file
        url:
          type: string
        mediaType:
          type: string
        providerMetadata: {}
      required:
        - type
        - url
        - mediaType
    StreamDataPart:
      type: object
      properties:
        type:
          type: string
          pattern: ^data-.+
        id:
          type: string
        data: {}
        transient:
          type: boolean
      required:
        - type
    StreamStepStartPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - start-step
      required:
        - type
    StreamStepFinishPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - finish-step
      required:
        - type
    StreamStartPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - start
        messageId:
          type: string
        messageMetadata: {}
      required:
        - type
    StreamFinishPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - finish
        messageMetadata: {}
      required:
        - type
    StreamMessageMetadataPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - message-metadata
        messageMetadata: {}
      required:
        - type
    StreamAbortPart:
      type: object
      properties:
        type:
          type: string
          enum:
            - abort
      required:
        - type
    DocumentKind:
      type: string
      enum:
        - text
    Document:
      type: object
      properties:
        id:
          type: string
          format: uuid
        versionNumber:
          type: integer
        createdAt:
          type: string
          format: date-time
        title:
          type: string
        content:
          type: string
        kind:
          $ref: "#/components/schemas/DocumentKind"
        userId:
          type: integer
      required:
        - id
        - versionNumber
        - createdAt
        - title
        - content
        - kind
        - userId
    CreateDocumentRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        content:
          type: string
          minLength: 1
        kind:
          $ref: "#/components/schemas/DocumentKind"
      required:
        - title
        - content
        - kind
    DocumentSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        kind:
          $ref: "#/components/schemas/DocumentKind"
        createdAt:
          type: string
          format: date-time
        userId:
          type: integer
      required:
        - id
        - title
        - kind
        - createdAt
        - userId
    ChatMessageVote:
      type: object
      properties:
        messageId:
          type: string
          format: uuid
        isUpvoted:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - messageId
        - isUpvoted
        - createdAt
        - updatedAt
    VoteMessageRequest:
      type: object
      properties:
        isUpvoted:
          type: boolean
      required:
        - isUpvoted
    BadPractice:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum:
            - Good Practice
            - Fixed
            - Critical Issue
            - Normal Issue
            - Minor Issue
            - Won't Fix
            - Wrong
      required:
        - title
        - description
        - status
    BadPracticeResult:
      type: object
      properties:
        bad_practice_summary:
          type: string
        bad_practices:
          type: array
          items:
            $ref: "#/components/schemas/BadPractice"
      required:
        - bad_practice_summary
        - bad_practices
    DetectorResponse:
      allOf:
        - $ref: "#/components/schemas/BadPracticeResult"
        - type: object
          properties:
            trace_id:
              type: string
          required:
            - trace_id
    DetectorRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        lifecycle_state:
          type: string
        repository_name:
          type: string
        pull_request_number:
          type: number
        bad_practice_summary:
          type: string
        bad_practices:
          type: array
          items:
            $ref: "#/components/schemas/BadPractice"
        pull_request_template:
          type: string
      required:
        - title
        - description
        - lifecycle_state
        - repository_name
        - pull_request_number
        - bad_practice_summary
        - bad_practices
        - pull_request_template
  parameters: {}
paths:
  /health:
    get:
      tags:
        - healthcheck
      summary: Perform a Health Check
      description: Endpoint to perform a healthcheck on. This endpoint can primarily
        be used by Docker to ensure robust container orchestration and
        management. Other services which rely on proper functioning of the API
        service will not deploy if this endpoint returns any other HTTP status
        code except 200 (OK).
      responses:
        "200":
          description: Return HTTP Status Code 200 (OK)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthCheck"
  /mentor/threads/grouped:
    get:
      tags:
        - mentor
      summary: List chat threads grouped by time buckets
      operationId: getGroupedThreads
      responses:
        "200":
          description: Grouped chat threads
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatThreadGroup"
  /mentor/chat:
    post:
      tags:
        - mentor
      summary: Handle mentor chat
      requestBody:
        description: Chat request body
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                message:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    role:
                      type: string
                      enum:
                        - user
                    parts:
                      type: array
                      items:
                        anyOf:
                          - type: object
                            properties:
                              type:
                                type: string
                                enum:
                                  - text
                              text:
                                type: string
                                minLength: 1
                                maxLength: 2000
                            required:
                              - type
                              - text
                          - type: object
                            properties:
                              type:
                                type: string
                                enum:
                                  - file
                              mediaType:
                                type: string
                                enum:
                                  - image/jpeg
                                  - image/png
                              name:
                                type: string
                                minLength: 1
                                maxLength: 100
                              url:
                                type: string
                                format: uri
                            required:
                              - type
                              - mediaType
                              - name
                              - url
                  required:
                    - id
                    - role
                    - parts
                previousMessageId:
                  type: string
              required:
                - id
                - message
      responses:
        "200":
          description: Event stream of chat updates.
          content:
            text/event-stream:
              schema:
                anyOf:
                  - $ref: "#/components/schemas/StreamTextStartPart"
                  - $ref: "#/components/schemas/StreamTextDeltaPart"
                  - $ref: "#/components/schemas/StreamTextEndPart"
                  - $ref: "#/components/schemas/StreamErrorPart"
                  - $ref: "#/components/schemas/StreamToolInputStartPart"
                  - $ref: "#/components/schemas/StreamToolInputDeltaPart"
                  - $ref: "#/components/schemas/StreamToolInputAvailablePart"
                  - $ref: "#/components/schemas/StreamToolInputErrorPart"
                  - $ref: "#/components/schemas/StreamToolOutputAvailablePart"
                  - $ref: "#/components/schemas/StreamToolOutputErrorPart"
                  - $ref: "#/components/schemas/StreamReasoningStartPart"
                  - $ref: "#/components/schemas/StreamReasoningDeltaPart"
                  - $ref: "#/components/schemas/StreamReasoningEndPart"
                  - $ref: "#/components/schemas/StreamSourceUrlPart"
                  - $ref: "#/components/schemas/StreamSourceDocumentPart"
                  - $ref: "#/components/schemas/StreamFilePart"
                  - $ref: "#/components/schemas/StreamDataPart"
                  - $ref: "#/components/schemas/StreamStepStartPart"
                  - $ref: "#/components/schemas/StreamStepFinishPart"
                  - $ref: "#/components/schemas/StreamStartPart"
                  - $ref: "#/components/schemas/StreamFinishPart"
                  - $ref: "#/components/schemas/StreamMessageMetadataPart"
                  - $ref: "#/components/schemas/StreamAbortPart"
  /mentor/threads/{threadId}:
    get:
      tags:
        - mentor
      summary: Get mentor chat thread detail
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: threadId
          in: path
      responses:
        "200":
          description: Thread detail with messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  title:
                    type:
                      - string
                      - "null"
                  selectedLeafMessageId:
                    type:
                      - string
                      - "null"
                    format: uuid
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        role:
                          type: string
                          enum:
                            - system
                            - user
                            - assistant
                        parts:
                          type: array
                          items:
                            anyOf:
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    enum:
                                      - text
                                  text:
                                    type: string
                                required:
                                  - type
                                  - text
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    enum:
                                      - reasoning
                                  text:
                                    type: string
                                  providerMetadata: {}
                                required:
                                  - type
                                  - text
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    enum:
                                      - file
                                  url:
                                    type: string
                                    format: uri
                                  mediaType:
                                    type: string
                                    enum:
                                      - image/jpeg
                                      - image/png
                                  name:
                                    type: string
                                required:
                                  - type
                                  - url
                                  - mediaType
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    pattern: ^tool-
                                required:
                                  - type
                                additionalProperties: {}
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    enum:
                                      - source-url
                                  url:
                                    type: string
                                  title:
                                    type: string
                                  sourceId:
                                    type: string
                                  providerMetadata: {}
                                required:
                                  - type
                                  - url
                              - type: object
                                properties:
                                  type:
                                    type: string
                                    enum:
                                      - source-document
                                  mediaType:
                                    type: string
                                  title:
                                    type: string
                                  filename:
                                    type: string
                                  providerMetadata: {}
                                required:
                                  - type
                                  - mediaType
                                  - title
                              - type: object
                                properties:
                                  type:
                                    type: string
                                required:
                                  - type
                                additionalProperties: {}
                        createdAt:
                          type: string
                          format: date-time
                        parentMessageId:
                          type:
                            - string
                            - "null"
                          format: uuid
                      required:
                        - id
                        - role
                        - parts
                required:
                  - id
                  - messages
        "404":
          description: Thread not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "503":
          description: Service temporarily unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /mentor/documents:
    post:
      tags:
        - documents
      summary: Create a new document
      requestBody:
        description: Create document
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDocumentRequest"
      responses:
        "201":
          description: Created document
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
    get:
      tags:
        - documents
      summary: List latest version of documents (no auth; all users)
      parameters:
        - schema:
            type:
              - integer
              - "null"
            minimum: 0
            default: 0
          required: false
          name: page
          in: query
        - schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          required: false
          name: size
          in: query
      responses:
        "200":
          description: Document summaries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DocumentSummary"
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /mentor/documents/{id}:
    get:
      tags:
        - documents
      summary: Get latest version of a document
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
      responses:
        "200":
          description: Document
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
    put:
      tags:
        - documents
      summary: Update a document (creates new version)
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
      requestBody:
        description: Update document
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDocumentRequest"
      responses:
        "200":
          description: Updated document
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
    delete:
      tags:
        - documents
      summary: Delete a document and all versions
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
      responses:
        "204":
          description: Deleted
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /mentor/documents/{id}/versions:
    get:
      tags:
        - documents
      summary: List versions of a document
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
        - schema:
            type:
              - integer
              - "null"
            minimum: 0
            default: 0
          required: false
          name: page
          in: query
        - schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          required: false
          name: size
          in: query
      responses:
        "200":
          description: Document versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
    delete:
      tags:
        - documents
      summary: Delete versions after timestamp
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
        - schema:
            type: string
            format: date-time
          required: true
          name: after
          in: query
      responses:
        "200":
          description: Deleted versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /mentor/documents/{id}/versions/{versionNumber}:
    get:
      tags:
        - documents
      summary: Get specific version
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: id
          in: path
        - schema:
            type:
              - integer
              - "null"
          required: false
          name: versionNumber
          in: path
      responses:
        "200":
          description: Document
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /mentor/chat/messages/{messageId}/vote:
    post:
      tags:
        - vote
      summary: Vote on a chat message (upvote/downvote)
      parameters:
        - schema:
            type: string
            format: uuid
          required: true
          name: messageId
          in: path
      requestBody:
        description: Vote request body
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VoteMessageRequest"
      responses:
        "200":
          description: Vote recorded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessageVote"
        "404":
          description: Message not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                  - error
  /detector:
    post:
      tags:
        - Detector
      summary: Detect bad practices for a pull request
      requestBody:
        description: Detector request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DetectorRequest"
      responses:
        "200":
          description: Detection response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DetectorResponse"
webhooks: {}
