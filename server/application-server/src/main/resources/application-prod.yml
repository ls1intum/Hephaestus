spring:
    datasource:
        url: jdbc:${DATABASE_URL}
        username: ${DATABASE_USERNAME}
        password: ${DATABASE_PASSWORD}
    jpa:
        hibernate:
            ddl-auto: none

    security:
        oauth2:
            resourceserver:
                jwt:
                    # Public URL for issuer validation (must match token's iss claim)
                    issuer-uri: ${KEYCLOAK_URL}/realms/${KEYCLOAK_REALM}

    mail:
        host: ${POSTFIX_HOST:localhost}
        port: ${POSTFIX_PORT:25}
        username: ${POSTFIX_USERNAME:}
        password: ${POSTFIX_PASSWORD:}
        properties:
            mail:
                transport:
                    protocol: smtp
                smtp:
                    starttls:
                        enable: true
                debug: false

hephaestus:
    host-url: ${APPLICATION_HOST_URL}

    webapp:
        url: ${APPLICATION_HOST_URL}

    leaderboard:
        schedule:
            day: ${LEADERBOARD_SCHEDULE_DAY:2}
            time: ${LEADERBOARD_SCHEDULE_TIME:9}
        notification:
            enabled: ${LEADERBOARD_NOTIFICATION_ENABLED:true}
            team: ${LEADERBOARD_NOTIFICATION_TEAM:all}
            channel-id: ${LEADERBOARD_NOTIFICATION_CHANNEL_ID:G6TCVL6HL}

    workspace:
        init-default: false

    intelligence-service:
        url: ${INTELLIGENCE_SERVICE_URL}

    mail:
        enabled: ${MAIL_ENABLED:true}
        sender: ${MAIL_SENDER:hephaestus@aet.cit.tum.de}

    detection:
        run-automatic-detection-for-all: ${RUN_AUTOMATIC_DETECTION_FOR_ALL:false}
        tracing:
            enabled: true
            # The host of the langfuse server
            host: ${LANGFUSE_BASE_URL}
            # The public key of the langfuse server
            public-key: ${LANGFUSE_PUBLIC_KEY}
            # The secret key of the langfuse server
            secret-key: ${LANGFUSE_SECRET_KEY}

    posthog:
        enabled: ${POSTHOG_ENABLED:false}
        api-host: ${POSTHOG_API_HOST:https://app.posthog.com}
        project-id: ${POSTHOG_PROJECT_ID:}
        personal-api-key: ${POSTHOG_PERSONAL_API_KEY:}

    github:
        app:
            # Set to 0 to disable GitHub App mode and use Personal Access Tokens instead
            id: ${GH_APP_ID:0}
            privateKeyLocation: ${GH_APP_PRIVATE_KEY_LOCATION:}
            privateKey: ${GH_APP_PRIVATE_KEY:}
        meta:
            auth-token: ${GH_AUTH_TOKEN:}

    sync:
        run-on-startup: ${MONITORING_RUN_ON_STARTUP:true}
        timeframe-days: ${MONITORING_TIMEFRAME:7}
        cron: ${MONITORING_SYNC_CRON:0 0 * * * *}
        cooldown-minutes: ${MONITORING_SYNC_COOLDOWN_IN_MINUTES:60}
        backfill:
            enabled: ${MONITORING_BACKFILL_ENABLED:true}
            batch-size: ${MONITORING_BACKFILL_BATCH_SIZE:50}
            rate-limit-threshold: ${MONITORING_BACKFILL_RATE_LIMIT_THRESHOLD:500}
            interval-seconds: ${MONITORING_BACKFILL_INTERVAL_SECONDS:60}
        nats:
            enabled: ${NATS_ENABLED:false}
            server: ${NATS_SERVER:}
            durable-consumer-name: ${NATS_DURABLE_CONSUMER_NAME:}

    # ═══════════════════════════════════════════════════════════════════════════
    # KEYCLOAK IDENTITY PROVIDER (Production)
    # ═══════════════════════════════════════════════════════════════════════════
    keycloak:
        url: ${KEYCLOAK_URL}
        realm: ${KEYCLOAK_REALM}
        client-id: ${KEYCLOAK_CLIENT_ID}
        client-secret: ${KEYCLOAK_CLIENT_SECRET}
        # Internal base URL for container-to-container access (defaults to public URL)
        internal-url: "${KEYCLOAK_INTERNAL_URL:${KEYCLOAK_URL}}"
        # Internal JWKS endpoint for containerized deployments (optional)
        jwk-set-uri: "${KEYCLOAK_JWK_SET_URI:${hephaestus.keycloak.internal-url}/realms/${KEYCLOAK_REALM}/protocol/openid-connect/certs}"

    # ═══════════════════════════════════════════════════════════════════════════
    # SLACK INTEGRATION (Production)
    # ═══════════════════════════════════════════════════════════════════════════
    slack:
        token: ${SLACK_BOT_TOKEN}
        signing-secret: ${SLACK_SIGNING_SECRET}

    # ═══════════════════════════════════════════════════════════════════════════
    # SENTRY ERROR TRACKING (Production)
    # ═══════════════════════════════════════════════════════════════════════════
    sentry:
        dsn: ${SENTRY_DSN}
