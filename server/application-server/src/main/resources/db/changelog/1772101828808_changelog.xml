<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!--
    =======================================================================================
    Provider-Agnostic Workspace Model (Issue #719)
    =======================================================================================

    Extends the workspace table to support multiple git providers (GitHub, GitLab).

    Changes:
    - Add server_url column for self-hosted git provider instances

    The GitProviderMode enum is stored as VARCHAR and gains a new value
    (GITLAB_PAT) in the Java code. No column migration is needed
    since PostgreSQL accepts any string in VARCHAR columns.

    Existing GitHub workspaces are unaffected: the new column is nullable
    with no default, so existing rows remain unchanged.
    =======================================================================================
    -->

    <!-- Add server_url for self-hosted git provider instances (GitHub Enterprise, self-hosted GitLab) -->
    <changeSet author="issue-719" id="1772101828808-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="workspace" columnName="server_url"/>
            </not>
        </preConditions>
        <addColumn tableName="workspace">
            <column name="server_url" type="VARCHAR(512)"/>
        </addColumn>
        <rollback>
            <dropColumn tableName="workspace" columnName="server_url"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
