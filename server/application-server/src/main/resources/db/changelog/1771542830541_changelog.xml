<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- ========================================================================
         Add previously-discarded GitHub fields to reviews and review comments
         ========================================================================

         These fields were already fetched from the GitHub GraphQL API but
         silently discarded during entity persistence. This migration adds
         the database columns so the application can store them.

         pull_request_review:
           created_at                    (timestamp of review creation)
           updated_at                    (timestamp of last review update)
           author_can_push_to_repository (whether the review author has push access)

         pull_request_review_comment:
           outdated                      (whether the comment is on an outdated diff)
    -->

    <changeSet id="1771542830541-1" author="hephaestus">
        <addColumn tableName="pull_request_review">
            <column name="created_at" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="true"/>
            </column>
            <column name="updated_at" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="true"/>
            </column>
            <column name="author_can_push_to_repository" type="BOOLEAN">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="1771542830541-2" author="hephaestus">
        <addColumn tableName="pull_request_review_comment">
            <column name="outdated" type="BOOLEAN">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

</databaseChangeLog>
