<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="1767052800000-1" author="architecture-audit">
        <comment>Add missing indexes on foreign key columns for query performance</comment>
        
        <!-- Issue table indexes -->
        <createIndex tableName="issue" indexName="idx_issue_repository_id">
            <column name="repository_id"/>
        </createIndex>
        <createIndex tableName="issue" indexName="idx_issue_author_id">
            <column name="author_id"/>
        </createIndex>
        <createIndex tableName="issue" indexName="idx_issue_state">
            <column name="state"/>
        </createIndex>
        
        <!-- Pull request review indexes -->
        <createIndex tableName="pull_request_review" indexName="idx_pr_review_author_id">
            <column name="author_id"/>
        </createIndex>
        <createIndex tableName="pull_request_review" indexName="idx_pr_review_submitted_at">
            <column name="submitted_at"/>
        </createIndex>
        <createIndex tableName="pull_request_review" indexName="idx_pr_review_pull_request_id">
            <column name="pull_request_id"/>
        </createIndex>
        
        <!-- Issue comment indexes -->
        <createIndex tableName="issue_comment" indexName="idx_issue_comment_author_id">
            <column name="author_id"/>
        </createIndex>
        <createIndex tableName="issue_comment" indexName="idx_issue_comment_created_at">
            <column name="created_at"/>
        </createIndex>
        
        <!-- Repository indexes -->
        <createIndex tableName="repository" indexName="idx_repository_name_with_owner">
            <column name="name_with_owner"/>
        </createIndex>
        <createIndex tableName="repository" indexName="idx_repository_organization_id">
            <column name="organization_id"/>
        </createIndex>
        
        <!-- Workspace membership index -->
        <createIndex tableName="workspace_membership" indexName="idx_workspace_membership_user_id">
            <column name="user_id"/>
        </createIndex>
        
        <!-- Chat message index -->
        <createIndex tableName="chat_message" indexName="idx_chat_message_thread_id">
            <column name="thread_id"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>
