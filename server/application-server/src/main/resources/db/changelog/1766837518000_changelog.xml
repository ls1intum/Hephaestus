<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- 
        Remove entity contamination from gitprovider module.
        
        These columns stored data that properly belongs in other modules:
        - badPracticeSummary, lastDetectionTime -> activity module (BadPracticeDetection entity)
        - leaguePoints -> workspace module (WorkspaceMembership entity, already exists there)
        
        See: DOMAIN_EVENT_ARCHITECTURE.md for full rationale.
    -->

    <changeSet id="1766837518000-1" author="copilot">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="pullrequest" columnName="bad_practice_summary"/>
        </preConditions>
        <comment>Drop bad_practice_summary column - data exists in bad_practice_detection.summary</comment>
        <dropColumn tableName="pullrequest" columnName="bad_practice_summary"/>
    </changeSet>

    <changeSet id="1766837518000-2" author="copilot">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="pullrequest" columnName="last_detection_time"/>
        </preConditions>
        <comment>Drop last_detection_time column - data exists in bad_practice_detection.detection_time</comment>
        <dropColumn tableName="pullrequest" columnName="last_detection_time"/>
    </changeSet>

    <changeSet id="1766837518000-3" author="copilot">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="hephaestus_user" columnName="league_points"/>
        </preConditions>
        <comment>Drop league_points column from user table - migrated to workspace_membership</comment>
        <dropColumn tableName="hephaestus_user" columnName="league_points"/>
    </changeSet>

</databaseChangeLog>
