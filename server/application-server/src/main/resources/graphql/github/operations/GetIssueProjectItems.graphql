# Follow-up pagination query for issue project items.
# Used when an issue has more than 5 project items (embedded inline limit).
# This query fetches additional project items starting from a cursor.

query GetIssueProjectItems($issueId: ID!, $first: Int!, $after: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    node(id: $issueId) {
        ... on Issue {
            id
            fullDatabaseId
            number
            projectItems(first: $first, after: $after, includeArchived: true) {
                totalCount
                pageInfo {
                    hasNextPage
                    endCursor
                }
                nodes {
                    id
                    fullDatabaseId
                    type
                    isArchived
                    createdAt
                    updatedAt

                    # Project reference - needed to link item to correct project
                    project {
                        id
                        fullDatabaseId
                        number
                        title
                        url
                        owner {
                            __typename
                            ... on Organization {
                                id
                                databaseId
                                login
                            }
                            ... on User {
                                id
                                databaseId
                                login
                            }
                        }
                    }

                    # Field values (embedded, first 10)
                    fieldValues(first: 10) {
                        totalCount
                        pageInfo {
                            hasNextPage
                            endCursor
                        }
                        nodes {
                            __typename
                            ... on ProjectV2ItemFieldTextValue {
                                text
                                field { ... on ProjectV2Field { id name } }
                            }
                            ... on ProjectV2ItemFieldNumberValue {
                                number
                                field { ... on ProjectV2Field { id name } }
                            }
                            ... on ProjectV2ItemFieldDateValue {
                                date
                                field { ... on ProjectV2Field { id name } }
                            }
                            ... on ProjectV2ItemFieldSingleSelectValue {
                                optionId
                                name
                                color
                                field { ... on ProjectV2SingleSelectField { id name } }
                            }
                            ... on ProjectV2ItemFieldIterationValue {
                                iterationId
                                title
                                startDate
                                duration
                                field { ... on ProjectV2IterationField { id name } }
                            }
                        }
                    }
                }
            }
        }
    }
}
