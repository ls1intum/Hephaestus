# GraphQL query for fetching project fields and configuration
# Used by GraphQL-based sync services to sync field definitions
#
# =============================================================================
# COST ANALYSIS
# =============================================================================
#
# This query has minimal nesting complexity:
#   - fields: Single-level collection with embedded options
#   - options: Inline array (not a paginated connection), no additional cost
#   - iterations: Inline array (not a paginated connection), no additional cost
#
# Cost calculation: fields(50) = 50 nodes = 1 cost point (very efficient)
#
# Default page size of 50 is appropriate because:
#   - Most projects have <50 custom fields
#   - Single-select options and iterations are inline (not paginated)
#   - No deeply nested collections that would multiply costs
#
# =============================================================================
# PAGINATION
# =============================================================================
#
# Supports pagination for projects with many fields (>50).
# Pass $fieldsAfter cursor to fetch subsequent pages.
# Projects with >50 fields are rare but handled gracefully.
#
# =============================================================================
# FRAGMENTS
# =============================================================================
#
# Uses fragments for consistent field selection. See ProjectFragments.graphql
# for canonical fragment definitions.

# Default 50 fields per page - see cost analysis above
query GetProjectWithFields($nodeId: ID!, $fieldsFirst: Int = 50, $fieldsAfter: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    node(id: $nodeId) {
        ... on ProjectV2 {
            id
            fullDatabaseId
            number
            title
            fields(first: $fieldsFirst, after: $fieldsAfter) {
                pageInfo {
                    hasNextPage
                    endCursor
                }
                totalCount
                nodes {
                    ...ProjectV2FieldConfigFields
                }
            }
        }
    }
}

# =============================================================================
# Fragment Definitions
# =============================================================================

# Fragment for project field definitions
# Covers all field types: standard fields, single-select, and iteration fields
fragment ProjectV2FieldConfigFields on ProjectV2FieldConfiguration {
    __typename
    ... on ProjectV2Field {
        id
        name
        dataType
        createdAt
        updatedAt
    }
    ... on ProjectV2SingleSelectField {
        id
        name
        dataType
        createdAt
        updatedAt
        options {
            id
            name
            color
            description
        }
    }
    ... on ProjectV2IterationField {
        id
        name
        dataType
        createdAt
        updatedAt
        configuration {
            iterations {
                id
                title
                startDate
                duration
            }
        }
    }
}
