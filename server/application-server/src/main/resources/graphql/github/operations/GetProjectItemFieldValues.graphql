# GraphQL query for paginating field values for a specific project item
# Used when an item has more field values than the inline page size (20)
#
# This query uses the node(id:) pattern to fetch a single item by its GraphQL node ID,
# then paginates through its field values starting from a cursor.
#
# =============================================================================
# COST ANALYSIS
# =============================================================================
#
# This is a follow-up pagination query for items with >20 field values.
# Since it fetches a single item, the cost is much lower than the main query:
#
#   Cost = fieldValues(50) * nested collections
#
# Using larger page sizes (50 for nested) is acceptable here because:
#   - Single item context (no multiplicative cost from parent items)
#   - Follow-up queries are rare (most items have <20 field values)
#
# =============================================================================
# FRAGMENTS
# =============================================================================
#
# Uses the FieldValueFields fragment for consistent field selection.
# See ProjectFragments.graphql for canonical fragment definitions.

query GetProjectItemFieldValues($itemId: ID!, $first: Int!, $after: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    node(id: $itemId) {
        ... on ProjectV2Item {
            id
            fieldValues(first: $first, after: $after) {
                pageInfo {
                    hasNextPage
                    endCursor
                }
                totalCount
                nodes {
                    ...FieldValueFields
                }
            }
        }
    }
}

# =============================================================================
# Fragment Definitions
# =============================================================================

# Fragment for all field value types
# Uses full page sizes (50) for nested collections since this query fetches a single item
fragment FieldValueFields on ProjectV2ItemFieldValue {
    __typename
    ... on ProjectV2ItemFieldTextValue {
        text
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldNumberValue {
        number
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldDateValue {
        date
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldSingleSelectValue {
        optionId
        name
        color
        field {
            ... on ProjectV2SingleSelectField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldIterationValue {
        iterationId
        title
        startDate
        duration
        field {
            ... on ProjectV2IterationField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldLabelValue {
        labels(first: 50) {
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                name
                color
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldMilestoneValue {
        milestone {
            id
            number
            title
            dueOn
            state
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldUserValue {
        users(first: 50) {
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                databaseId
                login
                avatarUrl
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldRepositoryValue {
        repository {
            id
            databaseId
            nameWithOwner
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldPullRequestValue {
        pullRequests(first: 20) {
            pageInfo {
                hasNextPage
            }
            nodes {
                __typename
                id
                number
                title
                state
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldReviewerValue {
        reviewers(first: 50) {
            pageInfo {
                hasNextPage
            }
            nodes {
                ...RequestedReviewerFields
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
}

# Fragment for RequestedReviewer union type
fragment RequestedReviewerFields on RequestedReviewer {
    __typename
    ... on User {
        id
        databaseId
        login
        avatarUrl
    }
    ... on Team {
        id
        databaseId
        name
        slug
    }
    ... on Bot {
        id
        databaseId
        login
        avatarUrl
    }
    ... on Mannequin {
        id
        databaseId
        login
        avatarUrl
    }
}
