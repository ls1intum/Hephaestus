# Fetches project items with field values. Cost-optimized page sizes for nested queries.
# See GitHubSyncConstants.java for page size rationale.
# The optional $filterQuery parameter supports GitHub Projects search syntax (e.g. "updated:>2025-01-01")
# to enable server-side incremental filtering.

query GetProjectItems($nodeId: ID!, $first: Int!, $after: String, $filterQuery: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    node(id: $nodeId) {
        ... on ProjectV2 {
            id
            fullDatabaseId
            number
            items(first: $first, after: $after, query: $filterQuery) {
                pageInfo {
                    hasNextPage
                    endCursor
                }
                totalCount
                nodes {
                    ...ProjectV2ItemFields
                    content {
                        ...ProjectV2ItemContentFields
                    }
                    fieldValues(first: 20) {
                        pageInfo {
                            hasNextPage
                            endCursor
                        }
                        totalCount
                        nodes {
                            ...FieldValueFieldsCostOptimized
                        }
                    }
                }
            }
        }
    }
}
