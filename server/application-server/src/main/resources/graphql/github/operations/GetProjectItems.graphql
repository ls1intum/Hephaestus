# GraphQL query for fetching project items with field values
# Used by GraphQL-based sync services

query GetProjectItems($nodeId: ID!, $first: Int!, $after: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    node(id: $nodeId) {
        ... on ProjectV2 {
            id
            fullDatabaseId
            number
            items(first: $first, after: $after) {
                pageInfo {
                    hasNextPage
                    endCursor
                }
                totalCount
                nodes {
                    __typename
                    id
                    fullDatabaseId
                    type
                    isArchived
                    createdAt
                    updatedAt
                    content {
                        __typename
                        ... on Issue {
                            id
                            fullDatabaseId
                            number
                            title
                            state
                            stateReason
                            author {
                                login
                            }
                            repository {
                                id
                                databaseId
                                nameWithOwner
                            }
                        }
                        ... on PullRequest {
                            id
                            fullDatabaseId
                            number
                            title
                            state
                            author {
                                login
                            }
                            repository {
                                id
                                databaseId
                                nameWithOwner
                            }
                        }
                        ... on DraftIssue {
                            id
                            title
                            body
                        }
                    }
                    fieldValues(first: 20) {
                        pageInfo {
                            hasNextPage
                            endCursor
                        }
                        nodes {
                            __typename
                            ... on ProjectV2ItemFieldTextValue {
                                text
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldNumberValue {
                                number
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldDateValue {
                                date
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldSingleSelectValue {
                                optionId
                                name
                                color
                                field {
                                    ... on ProjectV2SingleSelectField {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldIterationValue {
                                iterationId
                                title
                                startDate
                                duration
                                field {
                                    ... on ProjectV2IterationField {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldLabelValue {
                                labels(first: 10) {
                                    nodes {
                                        id
                                        name
                                        color
                                    }
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldMilestoneValue {
                                milestone {
                                    id
                                    number
                                    title
                                    dueOn
                                    state
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldUserValue {
                                users(first: 10) {
                                    nodes {
                                        id
                                        databaseId
                                        login
                                        avatarUrl
                                    }
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldRepositoryValue {
                                repository {
                                    id
                                    databaseId
                                    nameWithOwner
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldPullRequestValue {
                                pullRequests(first: 5) {
                                    nodes {
                                        id
                                        number
                                        title
                                        state
                                    }
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                            ... on ProjectV2ItemFieldReviewerValue {
                                reviewers(first: 10) {
                                    nodes {
                                        __typename
                                        ... on User {
                                            id
                                            databaseId
                                            login
                                            avatarUrl
                                        }
                                        ... on Team {
                                            id
                                            databaseId
                                            name
                                            slug
                                        }
                                        ... on Bot {
                                            id
                                            databaseId
                                            login
                                            avatarUrl
                                        }
                                        ... on Mannequin {
                                            id
                                            databaseId
                                            login
                                            avatarUrl
                                        }
                                    }
                                }
                                field {
                                    ... on ProjectV2Field {
                                        id
                                        name
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
