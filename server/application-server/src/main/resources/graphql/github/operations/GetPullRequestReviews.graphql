# GraphQL query for fetching pull request reviews
# Uses fullDatabaseId for reviews and comments (BigInt) since databaseId (Int) can overflow.
# User/Bot still use databaseId as fullDatabaseId is not available on Actor types.

query GetPullRequestReviews($owner: String!, $name: String!, $number: Int!, $first: Int!, $after: String) {
    rateLimit {
        cost
        limit
        remaining
        resetAt
    }
    repository(owner: $owner, name: $name) {
        pullRequest(number: $number) {
            reviews(first: $first, after: $after) {
                pageInfo {
                    hasNextPage
                    endCursor
                }
                totalCount
                nodes {
                    id
                    fullDatabaseId
                    body
                    state
                    url
                    createdAt
                    updatedAt
                    submittedAt

                    # Commit
                    commit {
                        oid
                    }

                    # Author
                    author {
                        __typename
                        ... on User {
                            id
                            databaseId
                            login
                            avatarUrl
                            createdAt
                        }
                        ... on Bot {
                            id
                            databaseId
                            login
                            avatarUrl
                        }
                        ... on Mannequin {
                            id
                            databaseId
                            login
                            avatarUrl
                        }
                        ... on Organization {
                            id
                            databaseId
                            login
                            avatarUrl
                        }
                    }

                    # Comments in review
                    comments(first: 10) {
                        totalCount
                        pageInfo {
                            hasNextPage
                        }
                        nodes {
                            id
                            fullDatabaseId
                            body
                            path
                            line
                            originalLine
                            startLine
                            originalStartLine
                            diffHunk
                            createdAt
                            updatedAt

                            # Comment author
                            author {
                                __typename
                                ... on User {
                                    id
                                    databaseId
                                    login
                                    avatarUrl
                                    createdAt
                                }
                                ... on Bot {
                                    id
                                    databaseId
                                    login
                                    avatarUrl
                                }
                                ... on Mannequin {
                                    id
                                    databaseId
                                    login
                                    avatarUrl
                                }
                                ... on Organization {
                                    id
                                    databaseId
                                    login
                                    avatarUrl
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
