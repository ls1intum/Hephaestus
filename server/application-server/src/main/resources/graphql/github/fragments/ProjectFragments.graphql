# Reusable fragments for GitHub GraphQL queries. Use ...FragmentName to include.
# Page sizes here are defaults; GetProjectItems.graphql uses cost-optimized sizes.

# Full Actor union with all fields needed for user upsert (timestamps on User).
# Used for author/mergedBy/creator on PRs, issues, reviews, comments, milestones, etc.
fragment ActorFields on Actor {
    __typename
    login
    ... on User {
        id
        databaseId
        avatarUrl
        name
        email
        createdAt
        updatedAt
    }
    ... on Bot {
        id
        databaseId
        avatarUrl
    }
    ... on Mannequin {
        id
        databaseId
        avatarUrl
    }
    ... on Organization {
        id
        databaseId
        avatarUrl
    }
}

# Direct User fields (not Actor union). Used for resolvedBy, assignees, members, collaborators.
fragment UserFields on User {
    id
    databaseId
    login
    avatarUrl
    name
    email
    createdAt
    updatedAt
}

fragment ActorFieldsCompact on Actor {
    __typename
    login
    ... on User {
        id
        databaseId
        avatarUrl
        name
    }
    ... on Bot {
        id
        databaseId
        avatarUrl
    }
    ... on Mannequin {
        id
        databaseId
        avatarUrl
    }
    ... on Organization {
        id
        databaseId
        avatarUrl
    }
}

fragment ProjectV2BaseFields on ProjectV2 {
    __typename
    id
    fullDatabaseId
    number
    title
    shortDescription
    readme
    template
    url
    closed
    closedAt
    public
    createdAt
    updatedAt
}

fragment ProjectV2OwnerFields on ProjectV2Owner {
    __typename
    ... on Organization {
        id
        databaseId
        login
    }
    ... on User {
        id
        databaseId
        login
    }
}

# Lightweight project reference for embedded project items on PRs/issues.
fragment ProjectV2RefFields on ProjectV2 {
    id
    fullDatabaseId
    number
    title
    url
    owner {
        ...ProjectV2OwnerFields
    }
}

fragment ProjectV2ItemFields on ProjectV2Item {
    __typename
    id
    fullDatabaseId
    type
    isArchived
    createdAt
    updatedAt
    creator {
        ...ActorFieldsCompact
    }
}

fragment ProjectV2ItemContentFields on ProjectV2ItemContent {
    ... on Issue {
        __typename
        id
        fullDatabaseId
        number
        title
        issueState: state
        stateReason
        author {
            login
        }
        repository {
            id
            databaseId
            nameWithOwner
        }
    }
    ... on PullRequest {
        __typename
        id
        fullDatabaseId
        number
        title
        prState: state
        author {
            login
        }
        repository {
            id
            databaseId
            nameWithOwner
        }
    }
    ... on DraftIssue {
        __typename
        id
        title
        body
    }
}

fragment FieldValueFields on ProjectV2ItemFieldValue {
    __typename
    ... on ProjectV2ItemFieldTextValue {
        text
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldNumberValue {
        number
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldDateValue {
        date
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldSingleSelectValue {
        optionId
        name
        color
        field {
            ... on ProjectV2SingleSelectField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldIterationValue {
        iterationId
        title
        startDate
        duration
        field {
            ... on ProjectV2IterationField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldLabelValue {
        labels(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                name
                color
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldMilestoneValue {
        milestone {
            id
            number
            title
            dueOn
            state
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldUserValue {
        users(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                databaseId
                login
                avatarUrl
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldRepositoryValue {
        repository {
            id
            databaseId
            nameWithOwner
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldPullRequestValue {
        pullRequests(first: 20) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                __typename
                id
                number
                title
                state
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldReviewerValue {
        reviewers(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                ...RequestedReviewerFields
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
}

fragment RequestedReviewerFields on RequestedReviewer {
    __typename
    ... on User {
        id
        databaseId
        login
        avatarUrl
        name
        email
        createdAt
        updatedAt
    }
    ... on Team {
        id
        databaseId
        name
        slug
    }
    ... on Bot {
        id
        databaseId
        login
        avatarUrl
    }
    ... on Mannequin {
        id
        databaseId
        login
        avatarUrl
    }
}

fragment ProjectV2FieldConfigFields on ProjectV2FieldConfiguration {
    __typename
    ... on ProjectV2Field {
        id
        name
        dataType
        createdAt
        updatedAt
    }
    ... on ProjectV2SingleSelectField {
        id
        name
        dataType
        createdAt
        updatedAt
        options {
            id
            name
            color
            description
        }
    }
    ... on ProjectV2IterationField {
        id
        name
        dataType
        createdAt
        updatedAt
        configuration {
            iterations {
                id
                title
                startDate
                duration
            }
        }
    }
}

fragment ProjectV2StatusUpdateFields on ProjectV2StatusUpdate {
    __typename
    id
    fullDatabaseId
    body
    bodyHTML
    startDate
    targetDate
    status
    createdAt
    updatedAt
    creator {
        ...ActorFields
    }
}

# Discussion category fields. Used by GetRepositoryDiscussions for inline categories.
fragment DiscussionCategoryFields on DiscussionCategory {
    id
    name
    slug
    emoji
    description
    isAnswerable
    createdAt
    updatedAt
}

# Discussion comment fields (without nested replies).
# Used by GetRepositoryDiscussions, GetDiscussionComments, and GetDiscussionCommentReplies.
fragment DiscussionCommentFields on DiscussionComment {
    id
    databaseId
    body
    url
    createdAt
    updatedAt
    isAnswer
    isMinimized
    minimizedReason
    authorAssociation
    author {
        ...ActorFields
    }
}

# Previously cost-optimized variant of FieldValueFields — now aligned with FieldValueFields
# page sizes (labels: 50, users: 50, pullRequests: 20, reviewers: 50) to prevent
# silent data truncation for projects with many field values.
# Shared fragment — used by GetProjectItems, GetRepositoryIssues, GetRepositoryPullRequests,
# GetIssueProjectItems, and GetPullRequestProjectItems.
fragment FieldValueFieldsCostOptimized on ProjectV2ItemFieldValue {
    __typename
    ... on ProjectV2ItemFieldTextValue {
        text
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldNumberValue {
        number
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldDateValue {
        date
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldSingleSelectValue {
        optionId
        name
        color
        field {
            ... on ProjectV2SingleSelectField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldIterationValue {
        iterationId
        title
        startDate
        duration
        field {
            ... on ProjectV2IterationField {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldLabelValue {
        labels(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                name
                color
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldMilestoneValue {
        milestone {
            id
            number
            title
            dueOn
            state
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldUserValue {
        users(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                id
                databaseId
                login
                avatarUrl
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldRepositoryValue {
        repository {
            id
            databaseId
            nameWithOwner
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldPullRequestValue {
        pullRequests(first: 20) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                __typename
                id
                number
                title
                state
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
    ... on ProjectV2ItemFieldReviewerValue {
        reviewers(first: 50) {
            totalCount
            pageInfo {
                hasNextPage
            }
            nodes {
                ...RequestedReviewerFields
            }
        }
        field {
            ... on ProjectV2Field {
                id
                name
            }
        }
    }
}
